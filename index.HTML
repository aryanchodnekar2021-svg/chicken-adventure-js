<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chicken Adventure - Multi Level Platformer</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: 'Arial', sans-serif;
    overflow: hidden;
  }
  #gameContainer {
    position: relative;
    box-shadow: 0 25px 70px rgba(0, 0, 0, 0.6);
  }
  canvas {
    display: block;
    background: #5c9ded;
    border: 4px solid #8b4513;
    border-radius: 8px;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
  }
  #ui {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: 15px;
    color: white;
    pointer-events: none;
    font-family: 'Courier New', monospace;
  }
  #hud {
    display: flex;
    justify-content: space-between;
    background: rgba(0, 0, 0, 0.7);
    padding: 12px 20px;
    border-radius: 10px;
    font-size: 20px;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }
  .hud-item {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  #levelDisplay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 64px;
    font-weight: bold;
    color: #ffd700;
    text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.9);
    opacity: 0;
    pointer-events: none;
    animation: levelAnnounce 3s ease-out;
  }
  @keyframes levelAnnounce {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
    20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
  }
  #gameOverScreen, #winScreen, #levelCompleteScreen {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.95);
    padding: 40px 60px;
    border-radius: 20px;
    text-align: center;
    color: white;
    display: none;
    border: 4px solid #ffd700;
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
  }
  #gameOverScreen h1 {
    color: #ff4444;
    font-size: 56px;
    margin-bottom: 20px;
    text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
  }
  #winScreen h1, #levelCompleteScreen h1 {
    color: #ffd700;
    font-size: 56px;
    margin-bottom: 20px;
    text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
  }
  .screen-text {
    font-size: 22px;
    margin: 12px 0;
    color: #ffeb3b;
  }
  .restart-btn, .next-btn {
    margin: 15px 10px;
    padding: 15px 35px;
    font-size: 20px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    pointer-events: all;
    font-weight: bold;
    transition: all 0.3s;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  .restart-btn:hover, .next-btn:hover {
    background: #45a049;
    transform: scale(1.05);
  }
  .next-btn {
    background: #ff9800;
  }
  .next-btn:hover {
    background: #f57c00;
  }
  #instructions {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    padding: 12px 25px;
    border-radius: 10px;
    color: white;
    font-size: 15px;
    text-align: center;
    border: 2px solid rgba(255, 215, 0, 0.3);
  }
  #startMenu {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(30, 60, 114, 0.95) 0%, rgba(42, 82, 152, 0.95) 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  #startMenu h1 {
    font-size: 72px;
    color: #ffd700;
    text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.9);
    margin-bottom: 20px;
    animation: titleBounce 2s ease-in-out infinite;
  }
  @keyframes titleBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  #startMenu .subtitle {
    font-size: 28px;
    color: #fff;
    margin-bottom: 40px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }
  #levelSelection {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 700px;
  }
  .level-btn {
    width: 120px;
    height: 120px;
    background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
    border: 4px solid #ffd700;
    border-radius: 15px;
    color: white;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 10px;
  }
  .level-btn:hover {
    transform: scale(1.1) translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.6);
    background: linear-gradient(135deg, #5bc45f 0%, #4fb352 100%);
  }
  .level-btn:active {
    transform: scale(1.05) translateY(-2px);
  }
  .level-btn .level-num {
    font-size: 48px;
  }
  .level-btn .level-name {
    font-size: 14px;
    opacity: 0.9;
  }
  .level-btn.hard {
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
  }
  .level-btn.hard:hover {
    background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
  }
  .level-btn.expert {
    background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
  }
  .level-btn.expert:hover {
    background: linear-gradient(135deg, #e57373 0%, #ef5350 100%);
  }
  .level-btn.master {
    background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
    animation: masterGlow 2s ease-in-out infinite;
  }
  .level-btn.master:hover {
    background: linear-gradient(135deg, #ab47bc 0%, #8e24aa 100%);
  }
  @keyframes masterGlow {
    0%, 100% { box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4); }
    50% { box-shadow: 0 6px 20px rgba(156, 39, 176, 0.8); }
  }
  #startInstructions {
    background: rgba(0, 0, 0, 0.7);
    padding: 20px 40px;
    border-radius: 15px;
    margin-top: 20px;
    max-width: 600px;
    text-align: center;
  }
  #startInstructions p {
    color: #fff;
    font-size: 16px;
    margin: 8px 0;
    line-height: 1.6;
  }
  .chicken-icon {
    font-size: 64px;
    animation: chickenFloat 3s ease-in-out infinite;
  }
  @keyframes chickenFloat {
    0%, 100% { transform: translateY(0) rotate(-5deg); }
    50% { transform: translateY(-15px) rotate(5deg); }
  }
</style>
</head>
<body>
<div id="gameContainer">
  <canvas id="game" width="900" height="600"></canvas>
  
  <!-- START MENU -->
  <div id="startMenu">
    <div class="chicken-icon">üêî</div>
    <h1>CHICKEN ADVENTURE</h1>
    <p class="subtitle">Choose Your Level!</p>
    
    <div id="levelSelection">
      <button class="level-btn" onclick="startLevel(1)">
        <div class="level-num">1</div>
        <div class="level-name">EASY</div>
      </button>
      <button class="level-btn" onclick="startLevel(2)">
        <div class="level-num">2</div>
        <div class="level-name">MEDIUM</div>
      </button>
      <button class="level-btn hard" onclick="startLevel(3)">
        <div class="level-num">3</div>
        <div class="level-name">HARD</div>
      </button>
      <button class="level-btn expert" onclick="startLevel(4)">
        <div class="level-num">4</div>
        <div class="level-name">EXPERT</div>
      </button>
      <button class="level-btn master" onclick="startLevel(5)">
        <div class="level-num">5</div>
        <div class="level-name">MASTER</div>
      </button>
    </div>
    
    <div id="startInstructions">
      <p><strong>üéÆ HOW TO PLAY:</strong></p>
      <p>‚¨ÖÔ∏è ‚û°Ô∏è Arrow Keys or A/D - Move the Chicken</p>
      <p>SPACE or ‚¨ÜÔ∏è - Jump</p>
      <p>üåæ Collect Seeds | ü¶ä Jump on Foxes | ü™π Reach the Nest!</p>
    </div>
  </div>
  
  <div id="ui">
    <div id="hud">
      <div class="hud-item">üåæ SEEDS: <span id="coinCount">0</span></div>
      <div class="hud-item">üêî LEVEL: <span id="levelNum">1</span></div>
      <div class="hud-item">‚ù§Ô∏è LIVES: <span id="lives">3</span></div>
      <div class="hud-item">‚≠ê SCORE: <span id="score">0</span></div>
    </div>
  </div>
  <div id="levelDisplay"></div>
  <div id="gameOverScreen">
    <h1>GAME OVER! üêî</h1>
    <p class="screen-text">The chicken couldn't make it!</p>
    <p class="screen-text">Final Score: <span id="finalScore">0</span></p>
    <p class="screen-text">Level Reached: <span id="finalLevel">1</span></p>
    <p class="screen-text">Seeds Collected: <span id="finalCoins">0</span></p>
    <button class="restart-btn" onclick="restartGame()">RESTART ADVENTURE</button>
  </div>
  <div id="levelCompleteScreen">
    <h1>LEVEL COMPLETE! üéâ</h1>
    <p class="screen-text">The chicken made it!</p>
    <p class="screen-text">Score: <span id="levelScore">0</span></p>
    <p class="screen-text">Seeds: <span id="levelCoins">0</span></p>
    <p class="screen-text">Bonus: <span id="levelBonus">0</span></p>
    <button class="next-btn" onclick="nextLevel()">NEXT LEVEL ‚ûú</button>
  </div>
  <div id="winScreen">
    <h1>YOU WIN! üèÜüêî</h1>
    <p class="screen-text">The chicken conquered all levels!</p>
    <p class="screen-text">Total Score: <span id="winScore">0</span></p>
    <p class="screen-text">Total Seeds: <span id="winCoins">0</span></p>
    <button class="restart-btn" onclick="restartGame()">PLAY AGAIN</button>
  </div>
  <div id="instructions">
    ‚¨ÖÔ∏è ‚û°Ô∏è Arrow Keys to Move | SPACE or ‚¨ÜÔ∏è to Jump | Collect Seeds üåæ & Reach the Nest! ü™π
  </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// UI Elements
const coinCountEl = document.getElementById("coinCount");
const livesEl = document.getElementById("lives");
const scoreEl = document.getElementById("score");
const levelNumEl = document.getElementById("levelNum");
const gameOverScreen = document.getElementById("gameOverScreen");
const winScreen = document.getElementById("winScreen");
const levelCompleteScreen = document.getElementById("levelCompleteScreen");
const levelDisplayEl = document.getElementById("levelDisplay");
const startMenu = document.getElementById("startMenu");

// Game Constants
const GRAVITY = 0.6;
const JUMP_STRENGTH = -14;
const MOVE_SPEED = 5;
const MAX_LEVELS = 5;

// Game State
let gameState = {
  coins: 0,
  score: 0,
  lives: 3,
  currentLevel: 1,
  gameOver: false,
  won: false,
  levelComplete: false,
  gameStarted: false
};

// Player (Chicken!)
const player = {
  x: 100,
  y: 400,
  width: 35,
  height: 35,
  velocityX: 0,
  velocityY: 0,
  jumping: false,
  onGround: false,
  direction: 1,
  invincible: false,
  invincibleTimer: 0,
  animFrame: 0
};

// Input
const keys = {};
document.addEventListener("keydown", e => {
  keys[e.key] = true;
  if ((e.key === " " || e.key === "ArrowUp") && player.onGround) {
    player.velocityY = JUMP_STRENGTH;
    player.jumping = true;
    player.onGround = false;
  }
});
document.addEventListener("keyup", e => {
  keys[e.key] = false;
});

// Level Designs
const levels = [
  // LEVEL 1 - Easy Introduction
  {
    platforms: [
      { x: 0, y: 560, width: 900, height: 40, type: 'ground' },
      { x: 200, y: 480, width: 120, height: 20, type: 'platform' },
      { x: 400, y: 400, width: 120, height: 20, type: 'platform' },
      { x: 600, y: 320, width: 120, height: 20, type: 'platform' },
    ],
    coins: [
      { x: 250, y: 440, width: 20, height: 20, collected: false },
      { x: 450, y: 360, width: 20, height: 20, collected: false },
      { x: 650, y: 280, width: 20, height: 20, collected: false },
      { x: 300, y: 520, width: 20, height: 20, collected: false },
      { x: 500, y: 520, width: 20, height: 20, collected: false },
    ],
    enemies: [
      { x: 350, y: 530, width: 30, height: 30, velocityX: 2, minX: 300, maxX: 500, type: 'fox' },
    ],
    flag: { x: 820, y: 460, width: 40, height: 100 }
  },
  
  // LEVEL 2 - Medium Difficulty
  {
    platforms: [
      { x: 0, y: 560, width: 900, height: 40, type: 'ground' },
      { x: 150, y: 480, width: 100, height: 20, type: 'platform' },
      { x: 320, y: 420, width: 100, height: 20, type: 'platform' },
      { x: 490, y: 360, width: 100, height: 20, type: 'platform' },
      { x: 660, y: 300, width: 100, height: 20, type: 'platform' },
      { x: 500, y: 480, width: 80, height: 20, type: 'platform' },
      { x: 200, y: 320, width: 100, height: 20, type: 'platform' },
    ],
    coins: [
      { x: 180, y: 440, width: 20, height: 20, collected: false },
      { x: 350, y: 380, width: 20, height: 20, collected: false },
      { x: 520, y: 320, width: 20, height: 20, collected: false },
      { x: 690, y: 260, width: 20, height: 20, collected: false },
      { x: 230, y: 280, width: 20, height: 20, collected: false },
      { x: 400, y: 520, width: 20, height: 20, collected: false },
      { x: 700, y: 520, width: 20, height: 20, collected: false },
    ],
    enemies: [
      { x: 350, y: 530, width: 30, height: 30, velocityX: 2.5, minX: 300, maxX: 600, type: 'fox' },
      { x: 520, y: 330, width: 30, height: 30, velocityX: 1.5, minX: 490, maxX: 590, type: 'fox' },
    ],
    flag: { x: 820, y: 460, width: 40, height: 100 }
  },
  
  // LEVEL 3 - Hard
  {
    platforms: [
      { x: 0, y: 560, width: 200, height: 40, type: 'ground' },
      { x: 300, y: 560, width: 600, height: 40, type: 'ground' },
      { x: 100, y: 450, width: 80, height: 20, type: 'platform' },
      { x: 250, y: 380, width: 80, height: 20, type: 'platform' },
      { x: 400, y: 310, width: 80, height: 20, type: 'platform' },
      { x: 550, y: 240, width: 80, height: 20, type: 'platform' },
      { x: 700, y: 310, width: 80, height: 20, type: 'platform' },
      { x: 350, y: 480, width: 100, height: 20, type: 'platform' },
      { x: 600, y: 450, width: 100, height: 20, type: 'platform' },
    ],
    coins: [
      { x: 130, y: 410, width: 20, height: 20, collected: false },
      { x: 280, y: 340, width: 20, height: 20, collected: false },
      { x: 430, y: 270, width: 20, height: 20, collected: false },
      { x: 580, y: 200, width: 20, height: 20, collected: false },
      { x: 730, y: 270, width: 20, height: 20, collected: false },
      { x: 380, y: 440, width: 20, height: 20, collected: false },
      { x: 630, y: 410, width: 20, height: 20, collected: false },
      { x: 400, y: 520, width: 20, height: 20, collected: false },
    ],
    enemies: [
      { x: 350, y: 530, width: 30, height: 30, velocityX: 3, minX: 300, maxX: 500, type: 'fox' },
      { x: 600, y: 530, width: 30, height: 30, velocityX: 2.5, minX: 550, maxX: 750, type: 'fox' },
      { x: 430, y: 280, width: 30, height: 30, velocityX: 1.5, minX: 400, maxX: 480, type: 'fox' },
    ],
    flag: { x: 820, y: 460, width: 40, height: 100 }
  },
  
  // LEVEL 4 - Expert
  {
    platforms: [
      { x: 0, y: 560, width: 150, height: 40, type: 'ground' },
      { x: 250, y: 560, width: 150, height: 40, type: 'ground' },
      { x: 500, y: 560, width: 150, height: 40, type: 'ground' },
      { x: 750, y: 560, width: 150, height: 40, type: 'ground' },
      { x: 100, y: 470, width: 70, height: 20, type: 'platform' },
      { x: 220, y: 400, width: 70, height: 20, type: 'platform' },
      { x: 340, y: 330, width: 70, height: 20, type: 'platform' },
      { x: 460, y: 260, width: 70, height: 20, type: 'platform' },
      { x: 580, y: 330, width: 70, height: 20, type: 'platform' },
      { x: 700, y: 400, width: 70, height: 20, type: 'platform' },
      { x: 300, y: 480, width: 80, height: 20, type: 'platform' },
      { x: 550, y: 480, width: 80, height: 20, type: 'platform' },
    ],
    coins: [
      { x: 130, y: 430, width: 20, height: 20, collected: false },
      { x: 250, y: 360, width: 20, height: 20, collected: false },
      { x: 370, y: 290, width: 20, height: 20, collected: false },
      { x: 490, y: 220, width: 20, height: 20, collected: false },
      { x: 610, y: 290, width: 20, height: 20, collected: false },
      { x: 730, y: 360, width: 20, height: 20, collected: false },
      { x: 330, y: 440, width: 20, height: 20, collected: false },
      { x: 580, y: 440, width: 20, height: 20, collected: false },
      { x: 450, y: 520, width: 20, height: 20, collected: false },
    ],
    enemies: [
      { x: 280, y: 530, width: 30, height: 30, velocityX: 2, minX: 250, maxX: 400, type: 'fox' },
      { x: 530, y: 530, width: 30, height: 30, velocityX: 2, minX: 500, maxX: 650, type: 'fox' },
      { x: 370, y: 300, width: 30, height: 30, velocityX: 1.5, minX: 340, maxX: 410, type: 'fox' },
      { x: 610, y: 300, width: 30, height: 30, velocityX: 1.5, minX: 580, maxX: 650, type: 'fox' },
    ],
    flag: { x: 820, y: 460, width: 40, height: 100 }
  },
  
  // LEVEL 5 - Master
  {
    platforms: [
      { x: 0, y: 560, width: 120, height: 40, type: 'ground' },
      { x: 200, y: 560, width: 120, height: 40, type: 'ground' },
      { x: 400, y: 560, width: 120, height: 40, type: 'ground' },
      { x: 600, y: 560, width: 120, height: 40, type: 'ground' },
      { x: 780, y: 560, width: 120, height: 40, type: 'ground' },
      { x: 80, y: 460, width: 60, height: 20, type: 'platform' },
      { x: 180, y: 380, width: 60, height: 20, type: 'platform' },
      { x: 280, y: 300, width: 60, height: 20, type: 'platform' },
      { x: 380, y: 220, width: 60, height: 20, type: 'platform' },
      { x: 480, y: 150, width: 60, height: 20, type: 'platform' },
      { x: 580, y: 220, width: 60, height: 20, type: 'platform' },
      { x: 680, y: 300, width: 60, height: 20, type: 'platform' },
      { x: 780, y: 380, width: 60, height: 20, type: 'platform' },
      { x: 250, y: 480, width: 70, height: 20, type: 'platform' },
      { x: 450, y: 480, width: 70, height: 20, type: 'platform' },
      { x: 650, y: 480, width: 70, height: 20, type: 'platform' },
    ],
    coins: [
      { x: 110, y: 420, width: 20, height: 20, collected: false },
      { x: 210, y: 340, width: 20, height: 20, collected: false },
      { x: 310, y: 260, width: 20, height: 20, collected: false },
      { x: 410, y: 180, width: 20, height: 20, collected: false },
      { x: 510, y: 110, width: 20, height: 20, collected: false },
      { x: 610, y: 180, width: 20, height: 20, collected: false },
      { x: 710, y: 260, width: 20, height: 20, collected: false },
      { x: 810, y: 340, width: 20, height: 20, collected: false },
      { x: 280, y: 440, width: 20, height: 20, collected: false },
      { x: 480, y: 440, width: 20, height: 20, collected: false },
      { x: 680, y: 440, width: 20, height: 20, collected: false },
      { x: 350, y: 520, width: 20, height: 20, collected: false },
    ],
    enemies: [
      { x: 230, y: 530, width: 30, height: 30, velocityX: 2.5, minX: 200, maxX: 320, type: 'fox' },
      { x: 430, y: 530, width: 30, height: 30, velocityX: 2.5, minX: 400, maxX: 520, type: 'fox' },
      { x: 630, y: 530, width: 30, height: 30, velocityX: 2.5, minX: 600, maxX: 720, type: 'fox' },
      { x: 310, y: 270, width: 30, height: 30, velocityX: 1.5, minX: 280, maxX: 340, type: 'fox' },
      { x: 510, y: 120, width: 30, height: 30, velocityX: 1.2, minX: 480, maxX: 540, type: 'fox' },
    ],
    flag: { x: 820, y: 460, width: 40, height: 100 }
  }
];

// Current level data
let platforms = [];
let coins = [];
let enemies = [];
let flag = {};

// Particles
let particles = [];

// Clouds
const clouds = [
  { x: 100, y: 80, width: 80, height: 40 },
  { x: 300, y: 120, width: 100, height: 50 },
  { x: 550, y: 60, width: 90, height: 45 },
  { x: 750, y: 140, width: 70, height: 35 },
];

function createParticle(x, y, color, count = 10) {
  for (let i = 0; i < count; i++) {
    particles.push({
      x: x,
      y: y,
      vx: (Math.random() - 0.5) * 6,
      vy: (Math.random() - 0.5) * 6 - 2,
      life: 1,
      color: color,
      size: Math.random() * 4 + 2
    });
  }
}

function updateParticles() {
  particles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.3;
    p.life -= 0.02;
  });
  particles = particles.filter(p => p.life > 0);
}

function drawParticles() {
  particles.forEach(p => {
    ctx.save();
    ctx.globalAlpha = p.life;
    ctx.fillStyle = p.color;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
  });
}

// Load level
function loadLevel(levelNum) {
  const level = levels[levelNum - 1];
  platforms = JSON.parse(JSON.stringify(level.platforms));
  coins = JSON.parse(JSON.stringify(level.coins));
  enemies = JSON.parse(JSON.stringify(level.enemies));
  flag = JSON.parse(JSON.stringify(level.flag));
  
  player.x = 100;
  player.y = 400;
  player.velocityX = 0;
  player.velocityY = 0;
  player.invincible = false;
  
  gameState.levelComplete = false;
  
  // Show level announcement
  levelDisplayEl.textContent = `LEVEL ${levelNum}`;
  levelDisplayEl.style.animation = 'none';
  setTimeout(() => {
    levelDisplayEl.style.animation = 'levelAnnounce 3s ease-out';
  }, 10);
}

// Start level from menu
function startLevel(levelNum) {
  gameState.gameStarted = true;
  gameState.currentLevel = levelNum;
  gameState.coins = 0;
  gameState.score = 0;
  gameState.lives = 3;
  gameState.gameOver = false;
  gameState.won = false;
  
  levelNumEl.textContent = levelNum;
  coinCountEl.textContent = '0';
  livesEl.textContent = '3';
  scoreEl.textContent = '0';
  
  startMenu.style.display = 'none';
  loadLevel(levelNum);
}

// Player update
function updatePlayer() {
  player.animFrame += 0.2;
  
  if (keys["ArrowLeft"] || keys["a"]) {
    player.velocityX = -MOVE_SPEED;
    player.direction = -1;
  } else if (keys["ArrowRight"] || keys["d"]) {
    player.velocityX = MOVE_SPEED;
    player.direction = 1;
  } else {
    player.velocityX *= 0.8;
  }

  player.velocityY += GRAVITY;
  player.x += player.velocityX;
  player.y += player.velocityY;

  if (player.x < 0) player.x = 0;
  if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

  player.onGround = false;
  platforms.forEach(platform => {
    if (checkCollision(player, platform)) {
      if (player.velocityY > 0 && player.y + player.height - player.velocityY <= platform.y) {
        player.y = platform.y - player.height;
        player.velocityY = 0;
        player.onGround = true;
        player.jumping = false;
      } else if (player.velocityY < 0 && player.y - player.velocityY >= platform.y + platform.height) {
        player.y = platform.y + platform.height;
        player.velocityY = 0;
      }
    }
  });

  if (player.y > canvas.height) {
    loseLife();
  }

  if (player.invincible) {
    player.invincibleTimer--;
    if (player.invincibleTimer <= 0) {
      player.invincible = false;
    }
  }
}

function checkCollision(rect1, rect2) {
  return rect1.x < rect2.x + rect2.width &&
         rect1.x + rect1.width > rect2.x &&
         rect1.y < rect2.y + rect2.height &&
         rect1.y + rect1.height > rect2.y;
}

function updateCoins() {
  coins.forEach(coin => {
    if (!coin.collected && checkCollision(player, coin)) {
      coin.collected = true;
      gameState.coins++;
      gameState.score += 100;
      coinCountEl.textContent = gameState.coins;
      scoreEl.textContent = gameState.score;
      createParticle(coin.x + 10, coin.y + 10, '#f4e04d', 15);
    }
  });
}

function updateEnemies() {
  enemies.forEach(enemy => {
    enemy.x += enemy.velocityX;

    if (enemy.x <= enemy.minX || enemy.x >= enemy.maxX) {
      enemy.velocityX *= -1;
    }

    if (checkCollision(player, enemy)) {
      if (player.velocityY > 0 && player.y + player.height - 10 < enemy.y) {
        enemy.defeated = true;
        player.velocityY = -8;
        gameState.score += 200;
        scoreEl.textContent = gameState.score;
        createParticle(enemy.x + 15, enemy.y + 15, '#ff6347', 20);
      } else if (!player.invincible) {
        loseLife();
      }
    }
  });

  enemies = enemies.filter(e => !e.defeated);
}

function checkWin() {
  if (checkCollision(player, flag)) {
    gameState.levelComplete = true;
    const bonus = gameState.lives * 500;
    gameState.score += bonus;
    
    levelCompleteScreen.style.display = 'block';
    document.getElementById('levelScore').textContent = gameState.score;
    document.getElementById('levelCoins').textContent = gameState.coins;
    document.getElementById('levelBonus').textContent = bonus;
  }
}

function nextLevel() {
  levelCompleteScreen.style.display = 'none';
  gameState.currentLevel++;
  
  if (gameState.currentLevel > MAX_LEVELS) {
    gameState.won = true;
    winScreen.style.display = 'block';
    document.getElementById('winScore').textContent = gameState.score;
    document.getElementById('winCoins').textContent = gameState.coins;
  } else {
    levelNumEl.textContent = gameState.currentLevel;
    loadLevel(gameState.currentLevel);
  }
}

function loseLife() {
  if (player.invincible) return;
  
  gameState.lives--;
  livesEl.textContent = gameState.lives;
  createParticle(player.x + 16, player.y + 16, '#ff4444', 25);
  
  if (gameState.lives <= 0) {
    gameState.gameOver = true;
    gameOverScreen.style.display = 'block';
    document.getElementById('finalScore').textContent = gameState.score;
    document.getElementById('finalLevel').textContent = gameState.currentLevel;
    document.getElementById('finalCoins').textContent = gameState.coins;
  } else {
    player.x = 100;
    player.y = 400;
    player.velocityX = 0;
    player.velocityY = 0;
    player.invincible = true;
    player.invincibleTimer = 120;
  }
}

// Drawing functions
function drawSky() {
  const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  gradient.addColorStop(0, '#5c9ded');
  gradient.addColorStop(1, '#87ceeb');
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function drawClouds() {
  clouds.forEach(cloud => {
    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    ctx.beginPath();
    ctx.arc(cloud.x, cloud.y, cloud.height / 2, 0, Math.PI * 2);
    ctx.arc(cloud.x + cloud.width / 3, cloud.y - 5, cloud.height / 2.5, 0, Math.PI * 2);
    ctx.arc(cloud.x + cloud.width / 1.5, cloud.y, cloud.height / 2.2, 0, Math.PI * 2);
    ctx.fill();
  });
}

function drawPlatforms() {
  platforms.forEach(platform => {
    if (platform.type === 'ground') {
      ctx.fillStyle = '#8b6914';
      ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
      ctx.fillStyle = '#6b8e23';
      ctx.fillRect(platform.x, platform.y, platform.width, 5);
      
      for (let i = 0; i < platform.width; i += 10) {
        ctx.fillStyle = '#4a7023';
        ctx.fillRect(platform.x + i, platform.y, 2, 5);
      }
    } else {
      ctx.fillStyle = '#d2691e';
      ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
      ctx.strokeStyle = '#8b4513';
      ctx.lineWidth = 2;
      ctx.strokeRect(platform.x, platform.y, platform.width, platform.height);
      
      const blocks = Math.floor(platform.width / 40);
      for (let i = 0; i < blocks; i++) {
        ctx.strokeRect(platform.x + i * 40, platform.y, 40, platform.height);
      }
    }
  });
}

function drawChicken() {
  ctx.save();
  
  if (player.invincible && Math.floor(Date.now() / 100) % 2) {
    ctx.globalAlpha = 0.5;
  }
  
  const centerX = player.x + player.width / 2;
  const centerY = player.y + player.height / 2;
  
  // Body
  ctx.fillStyle = '#ffffff';
  ctx.beginPath();
  ctx.ellipse(centerX, centerY + 5, 16, 12, 0, 0, Math.PI * 2);
  ctx.fill();
  
  // Head
  ctx.fillStyle = '#ffffff';
  ctx.beginPath();
  ctx.arc(centerX, centerY - 8, 10, 0, Math.PI * 2);
  ctx.fill();
  
  // Beak
  ctx.fillStyle = '#ffa500';
  ctx.beginPath();
  if (player.direction === 1) {
    ctx.moveTo(centerX + 8, centerY - 8);
    ctx.lineTo(centerX + 14, centerY - 6);
    ctx.lineTo(centerX + 8, centerY - 4);
  } else {
    ctx.moveTo(centerX - 8, centerY - 8);
    ctx.lineTo(centerX - 14, centerY - 6);
    ctx.lineTo(centerX - 8, centerY - 4);
  }
  ctx.closePath();
  ctx.fill();
  
  // Comb (red thing on head)
  ctx.fillStyle = '#ff0000';
  ctx.beginPath();
  ctx.moveTo(centerX - 3, centerY - 15);
  ctx.lineTo(centerX - 1, centerY - 20);
  ctx.lineTo(centerX + 1, centerY - 17);
  ctx.lineTo(centerX + 3, centerY - 20);
  ctx.lineTo(centerX + 5, centerY - 15);
  ctx.lineTo(centerX, centerY - 15);
  ctx.closePath();
  ctx.fill();
  
  // Eye
  ctx.fillStyle = '#000000';
  if (player.direction === 1) {
    ctx.fillRect(centerX + 4, centerY - 10, 3, 3);
  } else {
    ctx.fillRect(centerX - 7, centerY - 10, 3, 3);
  }
  
  // Legs (animated when moving)
  ctx.strokeStyle = '#ffa500';
  ctx.lineWidth = 3;
  const legOffset = Math.sin(player.animFrame) * 3;
  ctx.beginPath();
  ctx.moveTo(centerX - 5, centerY + 17);
  ctx.lineTo(centerX - 5, centerY + 25 + legOffset);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(centerX + 5, centerY + 17);
  ctx.lineTo(centerX + 5, centerY + 25 - legOffset);
  ctx.stroke();
  
  // Wing
  ctx.fillStyle = '#f0f0f0';
  ctx.beginPath();
  ctx.ellipse(centerX + 8 * player.direction, centerY + 2, 6, 8, Math.PI / 6, 0, Math.PI * 2);
  ctx.fill();
  
  ctx.restore();
}

function drawCoins() {
  coins.forEach(coin => {
    if (!coin.collected) {
      const time = Date.now() / 200;
      const bounce = Math.sin(time) * 3;
      
      // Seed/grain
      ctx.fillStyle = '#f4e04d';
      ctx.shadowBlur = 10;
      ctx.shadowColor = '#f4e04d';
      ctx.beginPath();
      ctx.ellipse(coin.x + 10, coin.y + 10 + bounce, 8, 10, 0, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.fillStyle = '#fffacd';
      ctx.beginPath();
      ctx.ellipse(coin.x + 10, coin.y + 10 + bounce, 5, 7, 0, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.shadowBlur = 0;
    }
  });
}

function drawEnemies() {
  enemies.forEach(enemy => {
    // Fox enemy
    ctx.fillStyle = '#ff6347';
    ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
    
    ctx.fillStyle = '#ff4500';
    ctx.fillRect(enemy.x + 5, enemy.y + 5, enemy.width - 10, enemy.height - 10);
    
    // Ears
    ctx.fillStyle = '#ff6347';
    ctx.beginPath();
    ctx.moveTo(enemy.x + 5, enemy.y);
    ctx.lineTo(enemy.x + 10, enemy.y - 8);
    ctx.lineTo(enemy.x + 12, enemy.y);
    ctx.closePath();
    ctx.fill();
    
    ctx.beginPath();
    ctx.moveTo(enemy.x + enemy.width - 5, enemy.y);
    ctx.lineTo(enemy.x + enemy.width - 10, enemy.y - 8);
    ctx.lineTo(enemy.x + enemy.width - 12, enemy.y);
    ctx.closePath();
    ctx.fill();
    
    // Eyes
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(enemy.x + 8, enemy.y + 10, 6, 6);
    ctx.fillRect(enemy.x + enemy.width - 14, enemy.y + 10, 6, 6);
    
    ctx.fillStyle = '#000000';
    ctx.fillRect(enemy.x + 10, enemy.y + 12, 3, 3);
    ctx.fillRect(enemy.x + enemy.width - 12, enemy.y + 12, 3, 3);
    
    // Snout
    ctx.fillStyle = '#ffffff';
    ctx.beginPath();
    ctx.arc(enemy.x + enemy.width / 2, enemy.y + 20, 5, 0, Math.PI * 2);
    ctx.fill();
    
    ctx.fillStyle = '#000000';
    ctx.beginPath();
    ctx.arc(enemy.x + enemy.width / 2, enemy.y + 20, 2, 0, Math.PI * 2);
    ctx.fill();
  });
}

function drawFlag() {
  // Nest (goal)
  ctx.fillStyle = '#8b4513';
  ctx.beginPath();
  ctx.ellipse(flag.x + 20, flag.y + 80, 20, 10, 0, 0, Math.PI * 2);
  ctx.fill();
  
  ctx.strokeStyle = '#654321';
  ctx.lineWidth = 2;
  for (let i = 0; i < 5; i++) {
    ctx.beginPath();
    ctx.arc(flag.x + 10 + i * 5, flag.y + 75, 15, Math.PI, Math.PI * 2);
    ctx.stroke();
  }
  
  // Egg
  ctx.fillStyle = '#f5f5dc';
  ctx.beginPath();
  ctx.ellipse(flag.x + 20, flag.y + 75, 8, 10, 0, 0, Math.PI * 2);
  ctx.fill();
  
  // Flag pole
  ctx.fillStyle = '#8b4513';
  ctx.fillRect(flag.x + 18, flag.y, 4, 60);
  
  // Flag
  ctx.fillStyle = '#00ff00';
  ctx.beginPath();
  ctx.moveTo(flag.x + 22, flag.y);
  ctx.lineTo(flag.x + 22, flag.y + 30);
  ctx.lineTo(flag.x + 2, flag.y + 15);
  ctx.closePath();
  ctx.fill();
  
  ctx.fillStyle = '#ffffff';
  ctx.font = '16px Arial';
  ctx.fillText('ü™π', flag.x + 6, flag.y + 20);
}

function restartGame() {
  gameState = {
    coins: 0,
    score: 0,
    lives: 3,
    currentLevel: 1,
    gameOver: false,
    won: false,
    levelComplete: false,
    gameStarted: false
  };
  
  particles = [];
  
  coinCountEl.textContent = '0';
  livesEl.textContent = '3';
  scoreEl.textContent = '0';
  levelNumEl.textContent = '1';
  gameOverScreen.style.display = 'none';
  winScreen.style.display = 'none';
  levelCompleteScreen.style.display = 'none';
  startMenu.style.display = 'flex';
}

function gameLoop() {
  if (gameState.gameStarted && !gameState.gameOver && !gameState.won && !gameState.levelComplete) {
    updatePlayer();
    updateCoins();
    updateEnemies();
    checkWin();
    updateParticles();
  }
  
  drawSky();
  drawClouds();
  drawPlatforms();
  drawFlag();
  drawCoins();
  drawEnemies();
  drawParticles();
  drawChicken();
  
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>